library(testthat)
library(data.table)
context("rcpp_use_after_deallocate")
library(testUBSAN)


user.display <- user_error_display("~/R/testUBSAN/inst/include/use_after_deallocate_log")
test_that("valgrind use after deallocate errors", {
  expect_match(user.display$arg.name,"size")
  expect_match(user.display$src.file.lines,"use_after_deallocate.cpp")
  expect_match(user.display$error.message[1],"Invalid read of size 4")

})


test_that("negative size array", {
  expect_lt(user.display$value[3],0)
  expect_match(user.display$error.message[3],"Argument 'size' of function __builtin_vec_new has a fishy (possibly negative) value")
  
})